<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css">
    <script type='text/javascript' src='js/zepto.min.js'></script>        
    <script type='text/javascript' src="js/bootstrap.min.js"></script>
    <script type='text/javascript' src="js/iscroll.js"></script>
    <script type='text/javascript' src="js/handlebars.js"></script>
    <script type='text/javascript' src="js/underscore-min.js"></script>
    <script type='text/javascript' src="js/backbone-min.js"></script>
    <script type='text/javascript' src="js/fastclick.js"></script>
    <style>
      body {
        overflow: hidden; 
        margin:0;
        padding:0;
      }
      .page {
        position: absolute;
        width: 100%;
        height: 100%;
        -webkit-transform:translate3d(0,0,0);
        z-index:4000;
        background:#fff;
      }
      .stage-center {
        top: 0;
        left: 0;
      }
      .stage-left {
        left: -100%;
      }
      .stage-right {
        left: 100%;
      }
      .stage-center.disabled {
        -webkit-transform: translate3d(252px, 0, 0);
        -moz-transform: translate3d(252px, 0, 0);
        transform: translate3d(252px, 0, 0);
      }
      #leftrail {
        height: 100%;
        width:250px;
        position:absolute;
        z-index:1;
        border-right:1px solid #ddd;
        background: #f5f5f5;              
      }
      .content {
        position:absolute;
        width: 100%;
        height: 100%;
        overflow:auto;
      }
      .toprail {
        position:absolute;
        z-index:200;
        width:100%;
      }
      .transition {
        -moz-transition-duration: .2s;
        -webkit-transition-duration: .2s;
        -o-transition-duration: .2s;
      }

      .navbar .navbar-inner {
        border-radius: 0;
        padding-left: 5px;
      }
      .navbar .navbar-inner .btn-navbar {
        display: block;
        float: left; 
      }
      .navbar-inverse .brand:hover {
        color:#999;
      }
      .content-inner {
        padding:55px 15px 15px;
      }

      @-webkit-keyframes opacity {
        0% { opacity: 1; }
      100% { opacity: 0; }
      }
      @-moz-keyframes opacity {
        0% { opacity: 1; }
      100% { opacity: 0; }
      }

      #loading {
        text-align: center; 
        margin: 150px 0 0 0;
        font-size: 20px;
        font-weight: 200;
        color:#aaa;
      }

      #loading span {
        font-size:45px;
        -webkit-animation-name: opacity;
        -webkit-animation-duration: 1s;
        -webkit-animation-iteration-count: infinite;

        -moz-animation-name: opacity;
        -moz-animation-duration: 1s;
        -moz-animation-iteration-count: infinite;
      }

      #loading span:nth-child(3) {
        -webkit-animation-delay: 100ms;
        -moz-animation-delay: 100ms;
      }

      #loading span:nth-child(4) {
        -webkit-animation-delay: 300ms;
        -moz-animation-delay: 300ms;
      }

      * { 
        /* prevent callout when holding tap on links (the native dialog that comes up) */
        -webkit-touch-callout: none !important; 
        /* prevent webkit from resizing text to fit */
        -webkit-text-size-adjust: none; 
        /* make transparent link selection, adjust last value opacity 0 to 1.0 */
        -webkit-tap-highlight-color: rgba(255, 255, 255, 0);
        -moz-tap-highlight-color: rgba(255, 255, 255, 0);
        /* prevent copy paste, to allow, change 'none' to 'text' */
        -webkit-user-select: none;
      }
      .icon-chevron-right {
        float: right;
        margin-top: 2px;
        margin-right: -6px;
        opacity: .25;
      }
      
      .scrollyV {
	position:absolute;
	z-index:100;
	width:4px;bottom:7px;top:2px;right:1px
      }

      .scrollyV > div {
	position:absolute;
	z-index:100;
	width:100%;

	/* The following is probably what you want to customize */
	background:#ccc;
	-webkit-background-clip:padding-box;
	-webkit-box-sizing:border-box;
	-webkit-border-radius:2px;
      }
    </style>
    <script>
      Zepto(function($){
        //define Router
        AppRouter = Backbone.Router.extend({
            routes: {
              "":"frontPage",
              "item/:name":"listPage",
              "item/:name/:id":"itemPage"
            },

            frontPage: function() {
              loadPage('Front page', renderFrontContent, 'front-page');
            },
            listPage: function (name) {
              loadPage(name, renderListContent, 'list-page');
            },
            itemPage: function (name, id) {
              loadPage(name + ' ' + id, renderItemContent, 'item-page');
            }
        });
        var appRouter = new AppRouter();
        Backbone.history.start();
        
        function loadPage(text, next, className) {
          var pageTemplate = Handlebars.compile($("#page-tpl").html());
          var page = $(pageTemplate({pageClassName: className, pageTitle: text}));
          changePage(page);
          window.setTimeout(next, 1000, text);
        }
        
        function changePage(page) {
          if ($('.stage-center').hasClass('disabled')) {
            $(page).addClass('disabled');
          }
          $('.page').remove();
          $(page).addClass('page stage-center transition');
          $('body').append(page);
          
          setTimeout(function() {
            $(page).removeClass('disabled');
            registerPageEvents();
          });
        }

        function renderFrontContent(text) {
          $('.stage-center .content-inner').html(text);
        }

        function renderListContent(text) {
          var content = '';
          for (var i = 0; i < 50; i++) content += '<li><a href="#item/' + text + '/' + i + '"><i class="icon-chevron-right"></i>' + text + ' ' + i + '</a></li>'
          content = '<ul class="nav nav-tabs nav-stacked">' + content + '</ul>';
          $('.stage-center .content-inner').html(content);
          contentScroll = new iScroll($('.stage-center .content').get(0), { scrollbarClass: 'scrolly' });
        }
                
        function renderItemContent(text) {
          var content = '';
          for (var i = 0; i < 1000; i++) content += '' + text + ' ';
          $('.stage-center .content-inner').html(content);
          contentScroll = new iScroll($('.stage-center .content').get(0), { scrollbarClass: 'scrolly' });
        }
                
        function registerPageEvents() {
          if (contentScroll != null) contentScroll.destroy();
          $('.stage-center').bind('touchstart mousedown', function(){
            $(this).removeClass('disabled');
          });
                    
          $('.menulink').bind('touchstart mousedown', function(e) {
            $('.stage-center').toggleClass('disabled');
            return false;
          });
          
          var touchstart;
          $('.stage-center').bind('touchstart', function(e){
            touchstart = e.touches[0].pageX
          }).bind('touchmove', function(e) {
            if (touchstart < 50 && e.touches[0].pageX > touchstart + 50) {
              $(this).addClass('disabled');
            }
          });
        }
        
        var leftrailScroll;
        var contentScroll;
        function initialize() {
          $('head').append('<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">');
          $('body').on('touchstart.dropdown', '.dropdown-menu', function (e) { e.stopPropagation(); }); //make bootstrap dropdowns work on touch devices

          //register leftrail events
          $('#leftrail a').click(function() {
            $('#leftrail li.active').removeClass('active');
            $(this).parent().addClass('active');
          });
          leftrailScroll = new iScroll($('#leftrail').get(0), { scrollbarClass: 'scrolly' });
        }
        
        initialize();
      });
      
      window.addEventListener('load', function() {
          new FastClick(document.body);
      }, false);
    </script>
  </head>
  <body>
    <script id="page-tpl" type="text/x-handlebars-template">
      <div class="page {{pageClassName}}">
        <div class="toprail navbar navbar-inverse">
          <div class="navbar-inner">
            <a class="btn btn-navbar menulink">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>
            <span class="brand">{{pageTitle}}</span>
            <div class="nav pull-right">
              <!--<a href="#" class="btn btn-inverse "><i class="icon-white icon-chevron-left"></i> Back</a>-->
            </div>
          </div>
        </div>
        <div class="content">
          <div class="content-inner">
            <p id="loading">Loading<br/><span>.</span><span>.</span><span>.</span></p>
          </div>
        </div>
      </div>
    </script>
    
    <div id="leftrail">
      <ul class="nav nav-list nav-inverse">
        <li class="nav-header">List header</li>
        <li><a href="#item/home">Home</a></li>
        <li><a href="#item/library">Library</a></li>
        <li><a href="#item/applications">Applications</a></li>
        <li class="nav-header">Another list header</li>
        <li><a href="#item/profile">Profile</a></li>
        <li><a href="#item/settings">Settings</a></li>
        <li class="divider"></li>
        <li><a href="#item/help">Help</a></li>
        <li class="nav-header">List header</li>
        <li><a href="#item/home">Home</a></li>
        <li><a href="#item/library">Library</a></li>
        <li><a href="#item/applications">Applications</a></li>
        <li class="nav-header">Another list header</li>
        <li><a href="#item/profile">Profile</a></li>
        <li><a href="#item/settings">Settings</a></li>
        <li class="divider"></li>
        <li><a href="#item/help">Help</a></li>
        <li class="nav-header">List header</li>
        <li><a href="#item/home">Home</a></li>
        <li><a href="#item/library">Library</a></li>
        <li><a href="#item/applications">Applications</a></li>
        <li class="nav-header">Another list header</li>
        <li><a href="#item/profile">Profile</a></li>
        <li><a href="#item/settings">Settings</a></li>
        <li class="divider"></li>
        <li><a href="#item/help">Help</a></li>        
      </ul>
    </div>
  </body>
</html>